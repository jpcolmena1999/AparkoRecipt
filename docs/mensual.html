<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Comprobante de Pago - Mensualidad</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- QR -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <style>
    @media print { body { width: 80mm; } }
    body{
      width:80mm; margin:0 auto; padding:10px;
      font-family: Arial, sans-serif; font-size:13px; color:#000;
    }
    h1{ margin:0 0 2px 0; font-size:16px; font-weight:bold; text-align:left; }
    .subtitulo{
      margin:0 0 8px 0;
      font-size:14px;
      font-weight:bold;
      text-align:left;
      text-transform:uppercase;
    }
    p{ margin:2px 0; }
    .etq{ font-weight:bold; }
    .sep{ border-top:1px solid #000; margin:8px 0; }
    .fila{ display:flex; justify-content:space-between; gap:8px; }
    .total{
      text-align:center; margin-top:8px;
    }
    .total .etq{ font-size:12px; text-transform:uppercase; }
    .total .val{ font-size:26px; font-weight:800; line-height:1.1; margin-top:2px; }
    .qrbox{ display:flex; justify-content:space-between; align-items:center; gap:10px; margin-top:8px; }
    .qr{ width:90px; height:90px; }
    .track{ font-weight:bold; font-size:13px; word-break:break-all; max-width:110px; text-align:left; }
    .msg{ font-size:11px; margin-top:8px; text-align:center; }
    #direccion{ font-weight:bold; }
  </style>
</head>
<body>
  <h1 id="empresa">PARQUEADERO</h1>
  <h2 class="subtitulo">PAGO DE MENSUALIDAD</h2>
  <p><span class="etq">NIT:</span> <span id="nit"></span></p>
  <p id="direccion"></p>
  <div class="sep"></div>

  <p class="fila"><span class="etq">Cliente:</span> <span id="cliente"></span></p>
  <p class="fila"><span class="etq">Fecha de pago:</span> <span id="fechaPago"></span></p>
  <p class="fila"><span class="etq">Mes cancelado:</span> <span id="mensual"></span></p>
  <p class="fila"><span class="etq">Tipo de tarifa:</span> <span id="tipoTarifa"></span></p>
  <div class="sep"></div>

  <div class="qrbox">
    <div>
      <p class="etq">N.º de Recibo:</p>
      <div class="track" id="nRecibo"></div>
    </div>
    <div id="qrcode" class="qr"></div>
  </div>

  <div class="sep"></div>

  <div class="total">
    <div class="etq">Total pagado</div>
    <div class="val">$<span id="valor"></span></div>
  </div>

  <div class="msg" id="msgLegal"></div>
  <div class="sep"></div>

  <script>
    function qp(k){ return new URLSearchParams(location.search).get(k) || ""; }
    function firstNonEmpty(){ for (const v of arguments){ if (v && String(v).trim() !== "") return v; } return ""; }
    function fmtCOP(n){
      const v = Number(String(n).replace(/[^0-9.-]/g,""));
      return isNaN(v) ? String(n) : v.toLocaleString("es-CO");
    }
    function setText(id, val){ const el=document.getElementById(id); if(el) el.textContent = val || ""; }

    function init(){
      setText("empresa", firstNonEmpty(qp("Empresa"), "APARKO"));
      setText("nit", qp("DatosNit"));
      setText("direccion", qp("DatosDireccion"));

      setText("cliente", firstNonEmpty(qp("Cliente"), qp("me_nombre")));
      setText("fechaPago", firstNonEmpty(qp("FechaPago"), qp("me_fecha_pago")));
      setText("mensual", firstNonEmpty(qp("Mensual"), qp("Vp.Mensual"), qp("VpMensual")));
      setText("tipoTarifa", firstNonEmpty(qp("TipoTarifa"), qp("me_tipo")));
      setText("valor", fmtCOP(firstNonEmpty(qp("Valor"), qp("me_valor"))));

      const nro = firstNonEmpty(qp("NRecibo"), qp("pago_nrecibo"));
      setText("nRecibo", nro);
      if(nro){
        new QRCode(document.getElementById("qrcode"), {
          text: String(nro), width: 90, height: 90,
          colorDark:"#000000", colorLight:"#ffffff",
          correctLevel: QRCode.CorrectLevel.M
        });
      }

      const msg = "Este documento es un comprobante de pago. Si desea la factura electrónica, comuníquese con el administrador, regístrese y con el N.º de recibo podrá descargar su factura.";
      setText("msgLegal", msg);

      setTimeout(()=>{ window.print(); setTimeout(()=>window.close(), 600); }, 300);
    }
    window.onload = init;
  </script>
</body>
</html>
